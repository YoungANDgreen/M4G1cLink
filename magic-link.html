<html>
  <body>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const oobCode = urlParams.get('oobCode'); // Firebase Magic Link parameter
      const apiKey = urlParams.get('apiKey');
      const mode = urlParams.get('mode');

      if (oobCode && apiKey && mode === 'signIn') {
        // Log the redirect attempt
        console.log('Firebase Magic Link parameters:', { oobCode, apiKey, mode });

        // Attempt to redirect to the app
        const redirectUrl = 'bkg://auth/callback?oobCode=' + encodeURIComponent(oobCode);
        console.log('Attempting redirect to:', redirectUrl);

        // In a browser, show a message and provide the URL for manual testing
        alert('Please copy this URL and paste it into your browser to complete the sign-in:\n' + window.location.href);
        window.location.href = redirectUrl; // This will fail in web, but works on mobile
      } else {
        alert('Invalid Magic Link. Please use the link from your email.');
      }
    </script>
  </body>
</html>
